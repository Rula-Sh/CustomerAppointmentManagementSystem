@model IEnumerable<AppointmentViewModel>

<!-- Carousel Start -->
<div class="container-fluid p-0 pb-5">
    <div class="owl-carousel header-carousel position-relative">
        <div class="owl-carousel-item position-relative">
            <img class="img-fluid" src="~/mytemplate/img/carousel-1.jpg" alt="">
            <div class="carousel-inner">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-8 text-center">
                            <h1 class="display-3 text-white animated slideInDown mb-4">Best CCTV & Security Solution For You</h1>
                            <p class="fs-5 text-white mb-4 pb-2">Vero elitr justo clita lorem. Ipsum dolor at sed stet sit diam no. Kasd rebum ipsum et diam justo clita et kasd rebum sea elitr.</p>
                            @* <a href="" class="btn btn-primary rounded-pill py-md-3 px-md-5 me-3 animated slideInLeft">Read More</a> *@
                            @* <a href="" class="btn btn-light rounded-pill py-md-3 px-md-5 animated slideInRight">Free Quote</a> *@
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="owl-carousel-item position-relative">
            <img class="img-fluid" src="~/mytemplate/img/carousel-2.jpg" alt="">
            <div class="carousel-inner">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-8 text-center">
                            <h1 class="display-3 text-white animated slideInDown mb-4">Smart Security Solution For All Business</h1>
                            <p class="fs-5 text-white mb-4 pb-2">Vero elitr justo clita lorem. Ipsum dolor at sed stet sit diam no. Kasd rebum ipsum et diam justo clita et kasd rebum sea elitr.</p>
                            @* <a href="" class="btn btn-primary rounded-pill py-md-3 px-md-5 me-3 animated slideInLeft">Read More</a> *@
                            @* <a href="" class="btn btn-light rounded-pill py-md-3 px-md-5 animated slideInRight">Free Quote</a> *@
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="owl-carousel-item position-relative">
            <img class="img-fluid" src="~/mytemplate/img/carousel-3.jpg" alt="">
            <div class="carousel-inner">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-12 col-lg-8 text-center">
                            <h1 class="display-3 text-white animated slideInDown mb-4">Innovative Solution For Security System</h1>
                            <p class="fs-5 fw-medium text-white mb-4 pb-2">Vero elitr justo clita lorem. Ipsum dolor at sed stet sit diam no. Kasd rebum ipsum et diam justo clita et kasd rebum sea elitr.</p>
                            @* <a href="" class="btn btn-primary rounded-pill py-md-3 px-md-5 me-3 animated slideInLeft">Read More</a> *@
                            @* <a href="" class="btn btn-light rounded-pill py-md-3 px-md-5 animated slideInRight">Free Quote</a> *@
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Carousel End -->




<div class="container-xxl py-5">
    <div class="container">
        <div class="row g-4">

            @if (User.IsInRole("Employee"))
            {
                <partial name="_EmployeeAppointments" model="Model" />
            }
            else if (User.IsInRole("Customer"))
            {
                <partial name="_CustomerAppointments" model="Model" />
            }

            @* OR(older syntax): @Html.Partial("_EmployeeAppointments", Model) *@
            @* or i could do it like this, but each will have a controller: @{ Html.RenderAction("_EmployeeAppointments"); } *@

        </div>
    </div>
</div>

<!-- Facts Start -->
<!-- About Start -->
<div class="container-fluid bg-light overflow-hidden my-5 px-lg-0">
    <div class="container about px-lg-0">
        <div class="row g-0 mx-lg-0">
            @*             <div class="col-lg-6 ps-lg-0" style="min-height: 400px;">
                 <div class="position-relative h-100">
                     <img class="position-absolute img-fluid w-100 h-100" src="img/about.jpg" style="object-fit: cover;" alt="">
                 </div>
             </div> *@
            <div class="col-lg-6 about-text py-5 wow fadeIn" data-wow-delay="0.5s">
                <div class="p-lg-5 pe-lg-0">
                    <div class="bg-primary mb-3" style="width: 60px; height: 2px;"></div>
                    <h1 class="display-5 mb-4">About Us</h1>
                    <p class="mb-4 pb-2">Tempor erat elitr rebum at clita. Diam dolor diam ipsum sit. Aliqu diam amet diam et eos. Clita erat ipsum et lorem et sit, sed stet lorem sit clita duo justo erat amet</p>
                    <div class="row g-4 mb-4 pb-3">
                        <div class="col-sm-6 wow fadeIn" data-wow-delay="0.1s">
                            @* <div class="d-flex align-items-center">
                                 <div class="btn-square bg-white rounded-circle" style="width: 64px; height: 64px;">
                                     <img class="img-fluid" src="img/icon/icon-1.png" alt="Icon">
                                 </div>
                                 <div class="ms-4">
                                     <h2 class="mb-1" data-toggle="counter-up">1234</h2>
                                     <p class="fw-medium text-primary mb-0">Happy Clients</p>
                                 </div>
                             </div> *@
                        </div>
                        @*  <div class="col-sm-6 wow fadeIn" data-wow-delay="0.3s">
                             <div class="d-flex align-items-center">
                                 <div class="btn-square bg-white rounded-circle" style="width: 64px; height: 64px;">
                                     <img class="img-fluid" src="img/icon/icon-5.png" alt="Icon">
                                 </div>
                                 <div class="ms-4">
                                     <h2 class="mb-1" data-toggle="counter-up">1234</h2>
                                     <p class="fw-medium text-primary mb-0">Projects Done</p>
                                 </div>
                             </div>
                         </div> *@
                    </div>
                    <a href="" class="btn btn-primary rounded-pill py-3 px-5">Explore More</a>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- About End -->

@section Scripts {

        <script>

            $(document).ready(function () {
                if ($("#customerAppointments").length) {
                        const tableId = '#customerAppointments';
                        if ($.fn.DataTable.isDataTable(tableId)) {
                            $(tableId).DataTable().clear().destroy();
                        }
                        $(tableId).DataTable({

                            "ajax": {
                                "url": "Home/LoadData",
                                "type": "POST",
                                "datatype": "json"
                            },

                            "columns": [
                                { "data": "name", "name": "name", "autoWidth": "10%", "className": "text-center" },
                                { "data": "date", "name": "date", "autoWidth": "20%", "className": "text-center" },
                                { "data": "status", "name": "status", "autoWidth": "10%", "className": "text-center" },
                                {
                                    data: null,
                                    render: function(data, type, row) {
                                        var actions = '';
                                        if (row.status === "Completed" || row.status === "Approved") {
                                            actions += '<a href="/Home/Details/' + row.id + '" class="btn btn-outline-secondary me-1"><i class="bi bi-list-ul"></i></a>';
                                        }
                                        if (row.status === "Pending" || row.status === "Rejected" || row.status === "Approved") {
                                            actions += '<a href="javascript:;" class="btn btn-danger js-delete ms-1" data-id="' + row.id + '"><i class="bi bi-trash"></i></a>';
                                        }
                                        return actions;
                                    },
                                },
                            ],
                            "drawCallback": function () {
                                // Bind delete button click handler
                                $('.js-delete').off('click').on('click', function () {
                                    var btn = $(this);
                                    bootbox.confirm({
                                        message: "Are you sure you want to delete the appointment?",
                                        buttons: {
                                            confirm: {
                                                label: 'Yes',
                                                className: 'btn-danger'
                                            },
                                            cancel: {
                                                label: 'No',
                                                className: 'btn-success'
                                            }
                                        },
                                        callback: function (result) {
                                            if(result){
                                                $.ajax({
                                                    url: 'home/delete/' + btn.data('id'),
                                                    type: 'DELETE',
                                                    success: function () {

                                                    var row = btn.closest('tr');
                                                    row.addClass('animate__animated animate__zoomOut');

                                                    setTimeout(function () {
                                                        row.remove();
                                                    }, 1000);

                                                    toastr.error('Appointment deleted');
                                                    },
                                                    error: function (err) {
                                                        console.log('An error occurred: ' + err);
                                                    }
                                                });
                                            }
                                        }
                                    });
                                });
                                // Similarly bind other dynamic buttons if any
                            }
                        });
                }
            });


        $(document).ready(function () {
            $('.js-complete').on('click', function () {
                var btn = $(this);

                console.log(btn.data('id'));
                bootbox.prompt({
                    title: "Provide your notes about the appointmet",
                    centerVertical: true,
                    callback: function(result){
                        if(result)
                        {
                            if(result == ''){result='no notes';}
                            $.ajax({ // $.ajax is a jQuery function used to perform an asynchronous HTTP (Ajax) request. Ajax allows you to send and receive data from a server without reloading the entire web page. This is particularly useful for creating dynamic and interactive web applications.
                                url: 'complete/',
                                type: 'POST',
                                data: { 'id' : btn.data('id'), 'notes' : result },
                                success: function () {
                                    var row = btn.closest('tr');
                                    row.addClass('animate__animated animate__zoomOut');

                                    setTimeout(function () {
                                        row.remove();
                                    }, 1000);

                                    toastr.success('Appointment Completed');
                                },
                                error: function () {
                                    toastr.error('Something went wrong!');
                                }
                            });
                        }
                        
                    }
                 });
            });

            // $('.js-delete').click(function () {
            //     var btn = $(this);
            //     bootbox.confirm({
            //         message: "Are you sure you want to delete the appointment?",
            //         buttons: {
            //             confirm: {
            //                 label: 'Yes',
            //                 className: 'btn-danger'
            //             },
            //             cancel: {
            //                 label: 'No',
            //                 className: 'btn-success'
            //             }
            //         },
            //         callback: function (result) {
            //             if(result){
            //                 $.ajax({
            //                     url: 'home/delete/' + btn.data('id'),
            //                     type: 'DELETE',
            //                     success: function () {

            //                     var row = btn.closest('tr');
            //                     row.addClass('animate__animated animate__zoomOut');

            //                     setTimeout(function () {
            //                         row.remove();
            //                     }, 1000);

            //                     toastr.error('Appointment deleted');
            //                     },
            //                     error: function (err) {
            //                         console.log('An error occurred: ' + err);
            //                     }
            //                 });
            //             }
            //         }
            //     });
            // });
        });
    </script>
}